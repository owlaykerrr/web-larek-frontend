# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src\scss\styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Интерфейс для хранения данных товара

```
interface IProduct { 
    id: string;
    description: string;
    image: string;
    title: string;
    category: string;
    price: number;
}
```

Интерфейс для модели данных приложения

```
 interface IAppState {
    catalog: IProduct[];
    preview: string;
    basket: string[];
    order: IOrder;
    total: string | number;
    loading: boolean;
}
```

Интерфейс для модели данных заказа товара, расширяется классом Form по интерфейсу IOrderForm

```
IOrder extends IOrderForm {
    items: string[];
}
```

Интерфейс для данных форм с которыми придётся взаимодействовать пользователю при заказе товара.

```
interface IOrderForm {
    address: string;
    email: string;
    phone: string;
    total: string | number;
    payment?: string;
}
```

Интерфейс представляет из себя успешный ответ от сервера, при успешном заказе товара.

```
interface IOrderResult {
    id: string;
}
```


## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:
- слой представления, отвечает за отображение данных на странице,
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь между слоем представления и слоем данных.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адресс сервера и опциональный обьект с заголовками запросов.
Методы:
- 'get' - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с обьектом, которым ответил сервер.
- 'post' - принимает обьект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода.
По умолчанию выполняется 'POST' запрос, но метод запроса может быть переопределён заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для
генерации событий.
Основные методы, реализуемые классом описаны интерфейсом 'IEvents':
- 'on' - подписка на событие
- 'emit' - инициализация события
- 'trigger' - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие.


#### Класс Model
Абстрактный класс дженерик, обобщающий в себе конструктор и метод привязки события. Принимает обьект данных неявного типа <T> и обьект события типа IEvent.
Производит слияние входящего обьекта с родительским.
Основные методы:
- 'emmitChanged' - регистрирует входящее событие в EventEmitter

#### Класс Component

Абстрактный класс дженерик, базовый класс для создания компонентов представления на странице. Принимает на вход контейнер разметки страницы.
Основные методы:
- 'toggleClass' - метод переключения класса элемента.
- 'setDisabled' - метод блокировки кнопки
- 'setText' - метод установки текста элементу.
- 'render' - метод слияния входящих данных для отрисовки элемента.


### Слой данных

#### Класс AppState
Класс является моделью данных всего приложения. Содержит в себе основные группы данных страницы и распределяет данные частей
приложения: каталог, превью карточки, корзина, форма заказа.
Расширяется базовым классом Model<T> и имплементирует интерфейс IAppState.
Поле класса:
- `catalog` - для данных списка товаров пришедших с сервера
- `preview` - для данных товара открытого в превью
- `basket` - для данных товара добавленных в корзину
- `order` - для данных заказа отпрвляющегося на сервер
- `formError` - для ошибок валидации

Методы:
- `addToOrder` - добавить товар в заказ
- `removeFromOrder` - удалить товар из заказа
- `setProductToBasket` - добавить карточку в козину
- `removeProductToBasket` - удалить карточку из корзины 
- `setCatalog`- установить данные в каталог товаров
- `setPreview` - установить данные в превью карточки
- `setOrderField` - установить поле заказа
- `setContactsField` - установить поле контактов заказа
- `validateOrder` - провести валидацию данных в заказе
- `ValidateContacts` - провести валидацию данных в поле контактов
- `get basket` - получить данные товаров в коризине
- `get statusBasket` - получить статус корзины
- `set total` - установить сумму товаров в коризине
- `getTotal` - получить сумму товаров коризины
- `clearBasket` - очистить корзину

#### Класс Product

Класс отвечает за хранение всех данных о товаре.
Расширяется базовым абстрактным классом Model<T> по интерфейсу IProduct


### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент)
передаваемых в них данных.

#### Класс Modal
Реализует модальное окно. Так же предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клавиатуру,
для закрытия модального окна по Esc, на клик оверлей и кнопку-крестик для закрытия попапа.
Является контейнером для любого содержимого страницы.
Расширяется базовым абстрактным классом Component<T> по интерфейсу IModalData

Конструктор:
- constructor(container: HTMLElement, events: IEvents) Конструктор принимает элемент разметки, начинкой которого будет наполнено модальное окно и экземпляр класса
`EventEmitter` для возможности инициации событий.

Поле класса:
- _closeButton - разметка кнопки закрытия модального окна
- _content - разметка контейнера для контента модального окна

Методы:
- set content - установить контент модального окна
- open - открыть модальное окно
- close - закрыть модальное окно
- render - отрисовать данные контента и открыть модальное окно


#### Класс Card
Отвечает за отображение данных карточки товара в каталоге товаров.
Расширяется базовым абстрактным классом Component<T> по интерфейсу ICard.
В конструкторе принимает container типа HTMLElement и обьект событий actions типа ICardActions.

Поля класса:
- `_title` - содержит разметку заголовка карточки
- `_category` - содержит разметку категории карточки
- `_image` - содержит разметку изображения карточки
- `_price` - содержит разметку цены карточки


Методы класса:

- `set title` - установить содержимое заголовка
- `set category` - установить содержимое заголовка
- `set image` - установить содержимое изображения
- `set price` - установить содержимое цены

#### Класс CardPreview
Отвечает за отображение карточки при превью(при нажатии на карточку пользователем)
Расширяется классом Card<T> наследует интерфейс ICardPreview
В конструкторе принимает container типа HTMLElement  и опциональный обьект события actions типа ICardActions

Поля класса:
- `_text` - хранит разметку описания товара в превью
- `_button` - хранит разметку кнопки 'заказать' в превью

Методы:
- `set text` - установка содержимого описания для превью карточки.

#### Класс CardBasket 
Отвечает за отображение карточки товара в корзине.
Поля отвечают за связь с разметкой компонента, а так же методы работы с ней.
Расширяется базовым абстрактным классом Component<T> по интерфейсу ICardBasket
В конструкторе принимает container типа HTMLElement  и опциональный обьект события actions типа ICardActions

Поля класса:
- `_title` - хранит разметку заголовка товара в корзине
- `_button` - хранит разметку кнопки удаления из корзины
- `_price` - хранит разметку цены товара
- `_index` - хранит разметку номера товара в корзине

Методы:
- `set title` - установка содержимого заголовка
- `set index` - установка содержимого номера
- `set price` - установка содержимого цены


#### Класс Page
Отвечает за отображение данных элементов страницы приложения: корзина, католог товаров, счетчик товаров в корзине
Поля отвечают за связь с разметкой, методы работы и наполнения блоков разметки данными, а так же за блокировку
прокрутки экрана при открытии модального окна(и закрытии разблокировку)
Расширяется базовым абстрактным классом Component<T> по интерфейсу IPage.
Конструктор:
- принимает container типа HTMLElement и обьект event типа IEvent и передаёт контейнер в родительский конструктор.
- сохраняет необходимые элементы разметки в полях
- вешает на кнопку корзины `_basket` слушатель события `click` при котором регистрируется событие `basket:open`

Поля класса:
- `_counter` - счетчик товаров в корзине
- `_catalog` - содержит разметку каталога товаров на странице
- `_wrapper` - содержит разметку всей страницы для возможной блокировки
_ `_basket` - кнопка корзины

Методы класса: 
- `set counter` - позволяет установить значения в счетчике покупок корзины
- `set catalog` - установить каталог
- `set locked` - устанавливает класс блокирующий прокрутку страницы


#### Класс Basket
Отвечает за отображение корзины в модальном окне. Имеет возможность удаления позиции товара из корзины.
Расширяется базовым абстрактным классом Component<T> по интерфейсу IBasket

Конструктор:
- принимает container типа HTMLElement  и обьект `event` типа `IEvent`
- передаёт container в родительский конструктор
- сохраняет необходимые элементы разметки в полях
- при условии что есть button, вешает на нее слушатель click с регистрацией события order:open

Поля класса:
- `_list` - хранит разметку содержимого списка товаров
- `_total` - хранит разметку суммы товаров
- `button` - хранит разметку кнопки для перехода на следующий шаг оформления заказа
- `items` - хранит весь список товаров в корзине


#### Класс Order
Отвечает за отображение первого шага оформления заказа в модальном окне, содержит выбор способа оплаты и поле ввода адресса.
Расширяется классом `Form<T>` по интерфейсу `IOrderForm`

Конструктор:
- принимает container типа HTMLElement  и обьект event типа IEvent
- принимает container и event  в родительский конструктор
- сохраняет необходимые элементы разметки в полях
- на кнопку выбора формы оплаты вешает слушатель click по которому методом payment производится установка класса
активности на эту кнопу.

Поля класса:
- `_buttons` - хранит разметку кнопок для выбора оплаты

Методы класса:
- `set payment` - устанавливает класс активности на кнопку
- `set address` - устанавливает значение в поле адресс


#### Класс Contacts 
Отвечает за отображение второго шага при заказе, в модальном окне.
Расширяется классом Form<T> по интерфейсу IOrderForm

Конструктор:
- принимает container типа HTMLElement и обьект event типа IEvent
- передаёт container и event в родительский конструктор

Методы:
- `set phone` - устанавливает значение поля ввода телефона
- `set email` - устанавливает значение поля ввода для почты


#### Класс Form<T>
Отвечает за работу с формами и их валидацию.
Является дженериком и принимает в переменную T тип данных компонента отображения.
Расширяется базовым абстрактным классом Component<T> по интерфейсу IFormState

Конструктор:
- принимает container типа HTMLElement и обьект event типа IEvent
- передаёт container и event в родительский конструктор
- сохраняет необходимые элементы разметки в полях
- вешает на container слушатель input при которм определяется поле воздействия, его данные(имя, значение), которые
после отправляются методу класса onInputChange в качестве аргументов.
- вешает на container слушатель submit при котором происходит регестрация события с указанием имени container

Поля класса:
- `_submit` - хранит разметку кнопки отправки формы
- `_errors` - хранит разметку вывода ошибок валидации

Методы класса: 

- `onInputChange` - регистрирует событие с именем конкретного поля
- `set valid` - метод установки валидности
- `set errors` - метод установки ошибки
- `render` - отрисовка формы и её элементов


#### Success
Отвечает за отображение успешного оформления заказа в модальном окне.
Расширяется базовым абстрактным классом Component<T> по интерфейсу ISuccess

Конструктор класса:

- принимает container типа HTMLElement и опциональный обьект события actions типа ISuccesActions
- передаёт container в родительский конструктор
- сохраняет необходимые элементы разметки в полях
- если обьект actions был передан, то вешает слушатель клика на _close с вызовом обьекта события actions

Поля класса:
- `_total` - разметка общей суммы товаров в заказе
- `_close` - разметка кнопки закрытия окна

Методы класса:
- `set total` - установка значения общей суммы заказа



### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бекэндом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.
Взаимодействие осуществляется за счёт событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных
в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе*\

*Список изменения даанных (генерируется классами моделями данных)*\
- `items:changed` - изменения массива карточек товаров
- `preview:changed` - изменение открываемой в модальном окне картинки карточки
- `order:ready` - готовность поля для получения вводимой информация, доступно после успешной валидации поля.

*Список, возникающие при взаимодействии пользователя с интерфейсом (генерируется классами, отвечающими за представление)*\
- `card:select` - выбор карточки товара для отображения в модальном окне
- `card:add` - событие добавляющее товар в корзину
- `card:remove` - событие удаляющее товар из корзины
- `basket:open` - открытие модального окна корзины 
- `order:change` - изменение данных форме заказа
- `contacts:change` - изменение данных в форме контактов
- `payment:change` - изменения способа оплаты в форме заказа
- `order:open` - событие вызывающее модальное окно оформление заказа
- `order:submit` - событие вызывающее модальное окно контактов
- `contacts:submit` - событие генерируемое при успешном заказе.
- `formErrors:change` - событие, сообшаюшее о изменении состоянии валидации формы 